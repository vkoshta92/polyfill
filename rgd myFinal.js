const set1Reel1 = [
  "BB",
  "DD",
  "HH",
  "BB",
  "CC",
  "GG",
  "BN",
  "CC",
  "FF",
  "WC",
  "BB",
  "DD",
  "WC",
  "AA",
  "GG",
  "FF",
  "WC",
  "HH",
  "FF",
  "AA",
  "KK",
  "EE",
  "HH",
  "GG",
  "BN",
  "EE",
  "KK",
  "FF",
  "CC",
  "DD",
  "BB",
  "GG",
  "HH",
  "BN",
  "GG",
  "CC",
  "EE",
  "HH",
  "GG",
  "KK",
  "AA",
  "EE",
  "JJ",
  "FF",
  "HH",
  "CC",
  "JJ",
  "FF",
  "LL",
  "DD",
  "HH",
  "GG",
  "JJ",
  "LL",
  "FF",
  "JJ",
  "EE",
  "AA",
  "FF",
  "KK",
  "HH",
  "GG",
  "LL",
];
const set1Reel2 = [
  "CC",
  "HH",
  "KK",
  "CC",
  "WC",
  "AA",
  "CC",
  "DD",
  "HH",
  "GG",
  "LL",
  "BN",
  "AA",
  "BB",
  "DD",
  "GG",
  "CC",
  "JJ",
  "HH",
  "BB",
  "DD",
  "GG",
  "BN",
  "CC",
  "HH",
  "LL",
  "WC",
  "HH",
  "GG",
  "AA",
  "DD",
  "BB",
  "FF",
  "GG",
  "AA",
  "DD",
  "JJ",
  "CC",
  "HH",
  "GG",
  "CC",
  "HH",
  "FF",
  "BB",
  "GG",
  "AA",
  "HH",
  "GG",
  "WC",
  "BB",
  "FF",
  "DD",
  "EE",
  "FF",
  "KK",
  "BN",
  "FF",
  "DD",
  "EE",
  "BB",
  "FF",
  "HH",
  "LL",
];
const set1Reel3 = [
  "HH",
  "AA",
  "CC",
  "HH",
  "BB",
  "AA",
  "HH",
  "FF",
  "JJ",
  "AA",
  "HH",
  "CC",
  "GG",
  "HH",
  "DD",
  "JJ",
  "GG",
  "HH",
  "LL",
  "KK",
  "HH",
  "GG",
  "BB",
  "EE",
  "AA",
  "JJ",
  "FF",
  "LL",
  "BB",
  "FF",
  "GG",
  "JJ",
  "FF",
  "GG",
  "BB",
  "HH",
  "GG",
  "BB",
  "KK",
  "FF",
  "EE",
  "KK",
  "CC",
  "DD",
  "FF",
  "GG",
  "DD",
  "EE",
  "LL",
  "CC",
  "EE",
  "JJ",
  "DD",
  "FF",
  "JJ",
  "DD",
  "KK",
  "FF",
  "HH",
  "KK",
  "FF",
  "EE",
  "LL",
];
const set1Reel4 = [
  "HH",
  "CC",
  "WC",
  "HH",
  "FF",
  "EE",
  "GG",
  "CC",
  "HH",
  "GG",
  "WC",
  "HH",
  "JJ",
  "WC",
  "BB",
  "JJ",
  "GG",
  "AA",
  "EE",
  "KK",
  "BN",
  "DD",
  "BB",
  "HH",
  "KK",
  "DD",
  "EE",
  "LL",
  "AA",
  "EE",
  "BB",
  "GG",
  "DD",
  "BB",
  "LL",
  "DD",
  "HH",
  "BN",
  "LL",
  "DD",
  "HH",
  "EE",
  "GG",
  "FF",
  "DD",
  "EE",
  "FF",
  "DD",
  "HH",
  "FF",
  "EE",
  "HH",
  "GG",
  "DD",
  "FF",
  "WC",
  "AA",
  "CC",
  "BB",
  "DD",
  "CC",
  "BB",
  "AA",
];
const set1Reel5 = [
  "EE",
  "FF",
  "BN",
  "EE",
  "BB",
  "BN",
  "EE",
  "GG",
  "BB",
  "HH",
  "EE",
  "CC",
  "FF",
  "EE",
  "WC",
  "HH",
  "BN",
  "GG",
  "CC",
  "EE",
  "HH",
  "DD",
  "CC",
  "GG",
  "HH",
  "CC",
  "DD",
  "BB",
  "GG",
  "FF",
  "DD",
  "JJ",
  "GG",
  "WC",
  "AA",
  "DD",
  "BB",
  "HH",
  "CC",
  "FF",
  "BB",
  "HH",
  "WC",
  "DD",
  "BB",
  "HH",
  "GG",
  "LL",
  "KK",
  "HH",
  "BB",
  "JJ",
  "GG",
  "LL",
  "JJ",
  "KK",
  "HH",
  "JJ",
  "KK",
  "LL",
  "GG",
  "KK",
  "LL",
];

const baseGameReels = [set1Reel1, set1Reel2, set1Reel3, set1Reel4, set1Reel5];

const set2Reel1 = [
  "BB",
  "DD",
  "HH",
  "BB",
  "CC",
  "GG",
  "WC",
  "CC",
  "FF",
  "BB",
  "HH",
  "DD",
  "WC",
  "AA",
  "FF",
  "HH",
  "JJ",
  "FF",
  "GG",
  "AA",
  "EE",
  "GG",
  "HH",
  "EE",
  "KK",
  "FF",
  "EE",
  "WC",
  "FF",
  "DD",
  "BB",
  "GG",
  "HH",
  "LL",
  "GG",
  "CC",
  "EE",
  "AA",
  "GG",
  "HH",
  "AA",
  "EE",
  "HH",
  "FF",
  "CC",
  "HH",
  "FF",
  "DD",
  "WC",
  "FF",
  "HH",
  "GG",
];
const set2Reel2 = [
  "CC",
  "HH",
  "FF",
  "CC",
  "WC",
  "AA",
  "CC",
  "DD",
  "HH",
  "GG",
  "JJ",
  "KK",
  "LL",
  "BB",
  "DD",
  "GG",
  "CC",
  "FF",
  "HH",
  "BB",
  "DD",
  "GG",
  "EE",
  "CC",
  "HH",
  "FF",
  "WC",
  "HH",
  "GG",
  "AA",
  "DD",
  "BB",
  "HH",
  "GG",
  "AA",
  "DD",
  "FF",
  "CC",
  "HH",
  "FF",
  "CC",
  "HH",
  "FF",
  "AA",
  "GG",
  "FF",
  "HH",
  "GG",
  "WC",
  "BB",
  "EE",
  "DD",
  "BB",
  "GG",
  "FF",
  "DD",
  "GG",
  "FF",
  "EE",
  "BB",
  "FF",
];
const set2Reel3 = [
  "HH",
  "JJ",
  "EE",
  "CC",
  "JJ",
  "HH",
  "AA",
  "FF",
  "KK",
  "AA",
  "HH",
  "CC",
  "GG",
  "KK",
  "HH",
  "DD",
  "GG",
  "HH",
  "LL",
  "DD",
  "HH",
  "GG",
  "BB",
  "FF",
  "AA",
  "LL",
  "FF",
  "DD",
  "BB",
  "GG",
  "EE",
  "FF",
  "GG",
  "BB",
  "FF",
  "HH",
  "BB",
  "GG",
  "FF",
  "HH",
  "EE",
  "FF",
  "CC",
  "DD",
  "FF",
  "GG",
  "DD",
  "HH",
  "EE",
  "FF",
  "HH",
  "EE",
  "CC",
];
const set2Reel4 = [
  "HH",
  "AA",
  "WC",
  "HH",
  "JJ",
  "KK",
  "GG",
  "LL",
  "HH",
  "GG",
  "FF",
  "CC",
  "HH",
  "FF",
  "BB",
  "HH",
  "GG",
  "EE",
  "HH",
  "FF",
  "AA",
  "DD",
  "BB",
  "HH",
  "FF",
  "DD",
  "EE",
  "FF",
  "AA",
  "EE",
  "BB",
  "GG",
  "DD",
  "BB",
  "GG",
  "DD",
  "HH",
  "FF",
  "EE",
  "DD",
  "HH",
  "FF",
  "GG",
  "HH",
  "DD",
  "FF",
  "GG",
  "EE",
  "FF",
  "HH",
  "DD",
  "FF",
  "EE",
  "DD",
  "FF",
  "WC",
  "AA",
  "CC",
  "BB",
  "DD",
  "CC",
  "AA",
  "BB",
];
const set2Reel5 = [
  "EE",
  "FF",
  "JJ",
  "EE",
  "BB",
  "KK",
  "EE",
  "GG",
  "CC",
  "HH",
  "EE",
  "CC",
  "FF",
  "EE",
  "WC",
  "HH",
  "LL",
  "GG",
  "CC",
  "BB",
  "HH",
  "DD",
  "GG",
  "HH",
  "CC",
  "GG",
  "DD",
  "BB",
  "HH",
  "FF",
  "DD",
  "EE",
  "GG",
  "WC",
  "AA",
  "DD",
  "BB",
  "HH",
  "GG",
  "FF",
  "BB",
  "HH",
  "WC",
  "DD",
  "BB",
  "HH",
  "GG",
  "CC",
  "HH",
  "GG",
  "BB",
];

const freeGameReels = [set2Reel1, set2Reel2, set2Reel3, set2Reel4, set2Reel5];

const paylines = [
  [1, 1, 1, 1, 1],
  [0, 0, 0, 0, 0],
  [2, 2, 2, 2, 2],
  [0, 1, 2, 1, 0],
  [2, 1, 0, 1, 2],
  [1, 0, 0, 0, 1],
  [1, 2, 2, 2, 1],
  [0, 1, 0, 1, 0],
  [2, 1, 2, 1, 2],
  [1, 1, 0, 1, 1],
  [1, 1, 2, 1, 1],
  [0, 1, 1, 1, 0],
  [2, 1, 1, 1, 2],
  [0, 1, 2, 2, 2],
  [2, 1, 0, 0, 0],
  [0, 2, 0, 2, 0],
  [2, 0, 2, 0, 2],
  [0, 2, 2, 2, 0],
  [2, 0, 0, 0, 2],
  [0, 0, 2, 0, 0],
];

const paytable = {
  WC: { 5: 200, 4: 100, 3: 40 },
  AA: { 5: 120, 4: 60, 3: 20 },
  BB: { 5: 80, 4: 40, 3: 16 },
  CC: { 5: 60, 4: 30, 3: 12 },
  DD: { 5: 40, 4: 25, 3: 10 },
  EE: { 5: 20, 4: 15, 3: 6 },
  FF: { 5: 16, 4: 10, 3: 5 },
  GG: { 5: 16, 4: 10, 3: 5 },
  HH: { 5: 12, 4: 8, 3: 4 },
  JJ: { 5: 12, 4: 8, 3: 4 },
  KK: { 5: 10, 4: 5, 3: 2 },
  LL: { 5: 10, 4: 5, 3: 2 },
  BN: { 5: 0, 4: 0, 3: 0 },
};
let baseGameWeight = Math.floor(Math.random() * 1500);
// Function to Generating Matrix---------------------------------------------------

function getRandomMatrix(reels) {
  const matrix = [];
  const indexes = [];

  for (let j = 0; j < 5; j++) {
    const reelLength = reels[j].length;
    let randomIndex = Math.floor(Math.random() * reelLength);

    for (let i = 0; i < 3; i++) {
      let reelIndex = randomIndex % reelLength;
      const symbol = reels[j][reelIndex];
      matrix[i] = matrix[i] || [];
      matrix[i][j] = symbol;
      indexes[i] = indexes[i] || [];
      indexes[i][j] = reelIndex;
      randomIndex++;
    }
  }

  matrix[1][2] = "WC";
  // matrix[1][0] = "BN";
  // matrix[1][1] = "BN";
  // matrix[1][3] = "BN";
  // matrix[1][4]= "BN";

  return matrix;
}

// kis kis jagah par wild ayega
featureWeight = {
  1: {
    columnOne: 0,
    columnTwo: 0,
    columnthree: 0,
    columnFour: 0,
    columnFive: 0,
  },
  2: {
    columnOne: 0,
    columnTwo: 0,
    columnthree: 0,
    columnFour: 0,
    columnFive: 1,
  },
  3: {
    columnOne: 0,
    columnTwo: 0,
    columnthree: 0,
    columnFour: 1,
    columnFive: 0,
  },
  4: {
    columnOne: 0,
    columnTwo: 0,
    columnthree: 0,
    columnFour: 1,
    columnFive: 1,
  },
  5: {
    columnOne: 0,
    columnTwo: 1,
    columnthree: 0,
    columnFour: 0,
    columnFive: 0,
  },
  6: {
    columnOne: 0,
    columnTwo: 1,
    columnthree: 0,
    columnFour: 0,
    columnFive: 1,
  },
  7: {
    columnOne: 0,
    columnTwo: 1,
    columnthree: 0,
    columnFour: 1,
    columnFive: 0,
  },
  8: {
    columnOne: 0,
    columnTwo: 1,
    columnthree: 0,
    columnFour: 1,
    columnFive: 1,
  },
  9: {
    columnOne: 1,
    columnTwo: 0,
    columnthree: 0,
    columnFour: 0,
    columnFive: 0,
  },
  10: {
    columnOne: 1,
    columnTwo: 0,
    columnthree: 0,
    columnFour: 0,
    columnFive: 1,
  },
  11: {
    columnOne: 1,
    columnTwo: 0,
    columnthree: 0,
    columnFour: 1,
    columnFive: 0,
  },
  12: {
    columnOne: 1,
    columnTwo: 0,
    columnthree: 0,
    columnFour: 1,
    columnFive: 1,
  },
  13: {
    columnOne: 1,
    columnTwo: 1,
    columnthree: 0,
    columnFour: 0,
    columnFive: 0,
  },
  14: {
    columnOne: 1,
    columnTwo: 1,
    columnthree: 0,
    columnFour: 0,
    columnFive: 1,
  },
  15: {
    columnOne: 1,
    columnTwo: 1,
    columnthree: 0,
    columnFour: 1,
    columnFive: 0,
  },
  16: {
    columnOne: 1,
    columnTwo: 1,
    columnthree: 0,
    columnFour: 1,
    columnFive: 1,
  },
};
// function to return the object from wild Pattern-------------------------

function getWildPossiblities(featureWeight, baseGameWeight) {
  if (baseGameWeight >= 0 && baseGameWeight <= 1350) {
    return featureWeight[1];
  } else if (baseGameWeight > 1350 && baseGameWeight <= 1355) {
    return featureWeight[2];
  } else if (baseGameWeight > 1355 && baseGameWeight <= 1360) {
    return featureWeight[3];
  } else if (baseGameWeight > 1360 && baseGameWeight <= 1375) {
    return featureWeight[4];
  } else if (baseGameWeight > 1375 && baseGameWeight <= 1395) {
    return featureWeight[5];
  } else if (baseGameWeight > 1395 && baseGameWeight <= 1400) {
    return featureWeight[6];
  } else if (baseGameWeight > 1400 && baseGameWeight <= 1405) {
    return featureWeight[7];
  } else if (baseGameWeight > 1405 && baseGameWeight <= 1425) {
    return featureWeight[8];
  } else if (baseGameWeight > 1425 && baseGameWeight <= 1445) {
    return featureWeight[9];
  } else if (baseGameWeight > 1445 && baseGameWeight <= 1450) {
    return featureWeight[10];
  } else if (baseGameWeight > 1450 && baseGameWeight <= 1455) {
    return featureWeight[11];
  } else if (baseGameWeight > 1455 && baseGameWeight <= 1460) {
    return featureWeight[12];
  } else if (baseGameWeight > 1460 && baseGameWeight <= 1470) {
    return featureWeight[13];
  } else if (baseGameWeight > 1470 && baseGameWeight <= 1480) {
    return featureWeight[14];
  } else if (baseGameWeight > 1480 && baseGameWeight <= 1490) {
    return featureWeight[15];
  } else {
    return featureWeight[16];
  }
}

function getColumsIndexWhereWildAppeard(wildreel) {
  let reelOfBaseGame;
  let index = [];

  if (wildreel.columnOne === 1) {
    reelOfBaseGame = 0;
    index.push(reelOfBaseGame);
  }
  if (wildreel.columnTwo === 1) {
    reelOfBaseGame = 1;
    index.push(reelOfBaseGame);
  }
  if (wildreel.columnthree === 1) {
    reelOfBaseGame = 2;
    index.push(reelOfBaseGame);
  }
  if (wildreel.columnFour === 1) {
    reelOfBaseGame = 3;
    index.push(reelOfBaseGame);
  }
  if (wildreel.columnFive === 1) {
    reelOfBaseGame = 4;
    index.push(reelOfBaseGame);
  }
  return index;
}

function changeWildRandomelyInBaseGame(matrix, indexsForWC) {
  const shallowCopyMatrix = matrix.map((row) => [...row]);
  for (let col = 0; col < indexsForWC.length; col++) {
    let arr = [];
    for (let row = 0; row < 3; row++) {
      if (
        shallowCopyMatrix[row][indexsForWC[col]] !== "WC" &&
        shallowCopyMatrix[row][indexsForWC[col]] !== "BN"
      ) {
        arr.push(row);
      }
    }

    let index = Math.floor(Math.random() * arr.length);

    shallowCopyMatrix[arr[index]][indexsForWC[col]] = "WC";
  }
  return shallowCopyMatrix;
}

function checkWinning(matrix) {
  let totalpayout = 0;
  for (let j = 0; j < 20; j++) {
    let element = matrix[paylines[j][0]][0];
    let counter = 0;
    let wildCounter = 0;
    for (let i = 0; i < 5; i++) {
      if (element === "WC" && "WC" === matrix[paylines[j][i]][i]) {
        wildCounter++;
      }

      if (
        element === matrix[paylines[j][i]][i] ||
        "WC" === matrix[paylines[j][i]][i]
      ) {
        counter++;
      } else if (element === "WC" && matrix[paylines[j][i]][i] !== "WC") {
        counter++;
        element = matrix[paylines[j][i]][i];
      } else {
        break;
      }
    }
    if (counter > 2) {
      let payout = 0;
      if (wildCounter >= 3) {
        if (paytable["WC"][wildCounter] > paytable[element][counter]) {
          payout = paytable["WC"][wildCounter];
        } else {
          payout = paytable[element][counter];
        }
      } else {
        payout = paytable[element][counter];
      }
      totalpayout += payout;
    }
  }

  return totalpayout;
}

function hasThreeAndMoreBNAlignedInMatrixReels(matrix) {
  let count = 0;
  for (let i = 0; i < 3; i++) {
    for (let j = 0; j < 5; j++) {
      if ((matrix[i][j] || finalMatrix[i][j]) == "BN") {
        count++;
      }
    }
  }

  if (count >= 3) {
    //console.log("count", count);
    return true;
  }
  return false;
}

function triggerWheel() {
  const freeGameWeight = Math.floor(Math.random() * 20) + 1;

  if (freeGameWeight === 1) {
    return { type: "credits", amount: 10 };
  } else if (freeGameWeight > 1 && freeGameWeight <= 5) {
    return { type: "freeSpins", amount: 20 };
  } else if (freeGameWeight > 5 && freeGameWeight <= 8) {
    return { type: "credits", amount: 30 };
  } else if (freeGameWeight > 8 && freeGameWeight <= 10) {
    return { type: "freeSpins", amount: 15 };
  } else if (freeGameWeight > 10 && freeGameWeight <= 14) {
    return { type: "credits", amount: 50 };
  } else if (freeGameWeight > 14 && freeGameWeight <= 16) {
    return { type: "freeSpins", amount: 12 };
  } else if (freeGameWeight === 17) {
    return { type: "credits", amount: 80 };
  } else if (freeGameWeight === 18) {
    return { type: "freeSpins", amount: 8 };
  } else if (freeGameWeight === 19) {
    return { type: "credits", amount: 100 };
  } else if (freeGameWeight === 20) {
    return { type: "freeSpins", amount: 5 };
  }
}

function freeGameWildExpend(matrix) {
  randomWeightReel0 = Math.floor(Math.random() * 100);
  randomWeightReel1 = Math.floor(Math.random() * 100);
  randomWeightReel3 = Math.floor(Math.random() * 100);
  randomWeightReel4 = Math.floor(Math.random() * 100);
  let hasWildExpend = false;

  if (randomWeightReel0 < 16) {
    matrix[0][0] = "WC";
    matrix[1][0] = "WC";
    matrix[2][0] = "WC";
    hasWildExpend = true;
  }
  if (randomWeightReel1 < 20) {
    matrix[0][1] = "WC";
    matrix[1][1] = "WC";
    matrix[2][1] = "WC";
    hasWildExpend = true;
  }
  if (randomWeightReel3 < 16) {
    matrix[0][3] = "WC";
    matrix[1][3] = "WC";
    matrix[2][3] = "WC";
    hasWildExpend = true;
  }
  if (randomWeightReel4 < 20) {
    matrix[0][4] = "WC";
    matrix[1][4] = "WC";
    matrix[2][4] = "WC";
    hasWildExpend = true;
  }

  return hasWildExpend;
}

function freeGameTotalWin() {
  let totalfreewin = 0;
  let creditWin = 0;
  let freespin = 0;
  let freeSpinsReward = triggerWheel();
  if (freeSpinsReward.type === "credits") {
    creditWin += freeSpinsReward.amount * 20;
    totalfreewin += creditWin;
  } else {
    freespin = freeSpinsReward.amount;
    let spin = freespin;
    for (spin = 0; spin < freespin; spin++) {
      let freematrix = getRandomMatrix(freeGameReels);
      totalfreewin += checkWinning(freematrix);

      let hasWildExpend = freeGameWildExpend(freematrix);
      if (hasWildExpend === true) {
        totalfreewin += checkWinning(freematrix);
      }
    }
  }

  return totalfreewin;
}

function finalRtp() {
  let totalBetForSpins = 0;
  let totalwinBaseGame = 0;
  let totalWinFreeGame = 0;
  let initialBet = 20;

  for (let noOfSpins = 0; noOfSpins <= 100000000; noOfSpins++) {
    totalBetForSpins += initialBet;
    matrix = getRandomMatrix(baseGameReels);
    totalwinBaseGame += checkWinning(matrix);
    let baseGameWeight = Math.floor(Math.random() * 1500) + 1;
    if (baseGameWeight > 1350) {
      let wildreel = getWildPossiblities(featureWeight, baseGameWeight);
      let indexsForWC = getColumsIndexWhereWildAppeard(wildreel);
      let finalMatrix = changeWildRandomelyInBaseGame(matrix, indexsForWC);
      totalwinBaseGame += checkWinning(finalMatrix);
      matrix = finalMatrix;
    }

    let scatterCountInMatrix = hasThreeAndMoreBNAlignedInMatrixReels(matrix);
    if (scatterCountInMatrix) {
      totalWinFreeGame += freeGameTotalWin();
    }

    if (noOfSpins % 10000000 == 0) {
      let baseGameRtp = (totalwinBaseGame / totalBetForSpins) * 100;
      let freeGameRtp = (totalWinFreeGame / totalBetForSpins) * 100;
      console.log(
        "............................................................"
      );
      console.log("Base Game Rtp: ", baseGameRtp);
      console.log("Free Game Rtp:", freeGameRtp);
      console.log("Total Rtp: ", baseGameRtp + freeGameRtp);
    }
  }
}
finalRtp();
